import numpy as np
from pathlib import Path
from tqdm import tqdm
from tqdm.contrib.concurrent import process_map

if __name__ == "__main__":
    dir = Path("statout")
    N = 105652
    summary = np.zeros(256, dtype=np.uint64)

    for freqs in process_map(np.load, dir.iterdir(), total=N):
        summary += freqs
        
    np.save("summary.npy", summary)
    order = np.unique(summary, return_inverse=True)
    print(order[1])

# ranking of bytes by descending frequency
ORDER = [255, 252, 242, 241, 247, 198, 190, 181, 244, 162, 180, 139, 203,
       153, 134, 214, 225, 140, 183, 107, 170, 147, 104,  84, 150,  87,
        69,  73, 138,  72,  79, 102, 248, 154, 115, 136, 238, 113,  85,
        59, 149,  94,  70, 106, 125,  92, 165, 105, 239, 196, 186, 227,
       195, 176, 174, 166, 192, 179, 142, 146, 133, 103,  88, 101, 234,
       223, 210, 213, 237, 249, 216, 182, 233, 204, 178, 168, 206, 219,
       188, 171, 243, 197, 201, 217, 207, 232, 211, 199, 185, 194, 159,
       120, 132, 145, 124, 161, 114, 231, 177, 212, 221, 245, 209, 175,
       226, 228, 205, 163, 220, 191, 218, 229, 208, 156, 230, 222, 250,
       236, 169, 172, 187, 167, 144,  36, 137, 110,  81,  82, 184, 123,
        90, 235, 160, 200,  64,  31, 135, 240, 122, 253,  80, 224,  14,
        20, 173,  47,  49,  26, 109,  38,  10,   6,  58,  23,  21,   0,
        77,  13,   9,  17, 111, 126,  45,  24,  93,  55,  19,   2,  78,
         5,  65,  35,  57,   8,   7,  12,  91,  18,  22,   1,  62,  15,
        75,  53, 127,  40,  60,  16,  68,  11,  41,  66, 215, 131, 128,
       193, 151,  34, 130, 158, 116,  95,  33,  30, 251,   4,  54,  44,
       118,  39,  89,  51,  67,   3,  52,  28, 121,  48,  29,  76,  97,
        74,  43,  42, 129,  37,  61,  27,  99,  56,  25,  63, 246, 148,
        46, 152, 157,  32,  50,  83, 155,  86,  71,  98, 141, 100, 112,
       108, 164,  96, 117, 119, 202, 143, 189, 254]
