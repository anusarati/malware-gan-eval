from PIL import Image
from math import sqrt
import sys
from pathlib import Path


def visualize(filepath, mode="L"):
    """
    Returns a square image of the file at filepath
    """
    with open(filepath, "rb", 0) as bytestream:
        bin = bytestream.readall()
        size = len(bin)

        side = sqrt(size)
        if mode == "RGB":
            side //= 3
        side = int(side)

        if mode in ("L", "RGB"):
            return Image.frombytes(mode, (side, side), bin)


def save(img, filename):
    img.save(filename + ".png")
    img.resize((128, 128), Image.NEAREST).save(filename + ".128.png")
    img.resize((512, 512), Image.NEAREST).save(filename + ".512.png")


if __name__ == "__main__":
    for filepath in sys.argv[1:]:
        img = visualize(filepath)
        filename = Path(filepath).name
        print(img.size)

        save(img, filename)

        img = visualize(filepath, mode="RGB")
        print(img.size)
        save(img, filename + ".color")
