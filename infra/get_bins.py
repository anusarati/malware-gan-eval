"""Select 100000 malware binaries split equally between the different classes"""

import sqlite3
import pandas as pd

con = sqlite3.connect("meta.db")
cur = con.cursor()

rows = set()

categories = (
    "adware",
    "flooder",
    "ransomware",
    "dropper",
    "spyware",
    "packed",
    "crypto_miner",
    "file_infector",
    "installer",
    "worm",
    "downloader",
)

N_PER_CATEGORY = 10000

for category in categories:
    res = cur.execute(f"SELECT * FROM meta WHERE {category} >= 1;")
    added = 0
    while added < N_PER_CATEGORY:
        row = res.fetchone()
        if row not in rows:
            rows.add(row)
            added += 1
            if (added + 1) % 1000 == 0:
                print(added + 1)

columns = ("sha256", "is_malware", "rl_fs_t", "rl_ls_const_positives") + categories
df = pd.DataFrame(rows, columns=columns)
df.to_pickle("100k.pkl")

import pandas as pd
df = pd.read_pickle('100k.pkl')
with open("get.txt", "w") as f:
    for hash in df["sha256"]:
        print(
            f"http://sorel-20m.s3.amazonaws.com/09-DEC-2020/binaries/{hash}",
            file=f,
        )

# cat get.txt | xargs -P 100 -I{} wget -q --show-progress -nc {}
